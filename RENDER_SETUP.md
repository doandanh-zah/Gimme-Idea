# Render Deployment Setup Guide

This guide will help you deploy the Gimme Idea backend to Render.com and configure all required environment variables.

## Prerequisites

1. A [Render.com](https://render.com) account
2. A [Supabase](https://supabase.com) project set up with the database schema
3. GitHub repository connected to Render

## Deployment Steps

### 1. Create New Web Service on Render

1. Go to [Render Dashboard](https://dashboard.render.com/)
2. Click "New +" → "Web Service"
3. Connect your GitHub repository: `Gimme-Idea`
4. Render should auto-detect the `render.yaml` configuration

### 2. Configure Environment Variables

**CRITICAL:** The backend will fail without these environment variables. You must set them before deployment.

Go to your service → "Environment" tab and add the following variables:

#### Required Supabase Variables

Get these from your Supabase project dashboard ([https://app.supabase.com](https://app.supabase.com)):

1. **SUPABASE_URL**
   - Location: Settings → API → Project URL
   - Format: `https://xxxxxxxxxxxxx.supabase.co`
   - Example: `https://abcdefghijklmn.supabase.co`

2. **SUPABASE_ANON_KEY**
   - Location: Settings → API → Project API keys → `anon` `public`
   - Format: Long JWT token starting with `eyJ...`
   - This is safe to expose in frontend code

3. **SUPABASE_SERVICE_KEY**
   - Location: Settings → API → Project API keys → `service_role` `secret`
   - Format: Long JWT token starting with `eyJ...`
   - **WARNING:** Keep this secret! Never expose in frontend code

#### Auto-Generated Variables

These are already configured in `render.yaml` and don't need manual setup:

- **JWT_SECRET** - Auto-generated by Render
- **JWT_EXPIRES_IN** - Set to `7d` (7 days)
- **NODE_ENV** - Set to `production`
- **PORT** - Set to `10000`
- **NODE_VERSION** - Set to `20.19.0`
- **SOLANA_NETWORK** - Set to `mainnet-beta`
- **SOLANA_RPC_URL** - Set to `https://api.mainnet-beta.solana.com`

#### Optional (Set After Frontend Deployment)

- **FRONTEND_URL** - Your frontend URL for CORS
  - Development: `http://localhost:3000`
  - Production: `https://your-frontend-domain.vercel.app`

### 3. Deploy

1. After setting all environment variables, click "Create Web Service"
2. Render will automatically:
   - Install Node.js 20.19.0
   - Run `npm install` in the `backend/` directory
   - Run `npm run build` to compile TypeScript
   - Start the server with `npm run start:prod`

### 4. Verify Deployment

Once deployed, test your backend:

```bash
# Health check (should return JSON with success: true)
curl https://gimme-idea.onrender.com/api

# Should return:
# {
#   "success": true,
#   "message": "Gimme Idea API is running",
#   "timestamp": "2024-01-01T00:00:00.000Z",
#   "version": "1.0.0"
# }
```

### 5. Common Issues & Solutions

#### Issue: "Missing Supabase configuration" Error

**Cause:** SUPABASE_URL or SUPABASE_ANON_KEY not set

**Solution:**
1. Go to Render Dashboard → Your Service → Environment
2. Add the missing variables
3. Click "Save Changes" (this will trigger a redeploy)

#### Issue: "Supabase admin client not configured" Error

**Cause:** SUPABASE_SERVICE_KEY not set

**Solution:**
1. Go to Supabase → Settings → API
2. Copy the `service_role` key (NOT the `anon` key)
3. Add it to Render environment variables as `SUPABASE_SERVICE_KEY`

#### Issue: 500 Error on /api/auth/login

**Possible causes:**
1. Missing environment variables (see above)
2. Supabase database not set up correctly
3. Frontend URL not whitelisted in CORS

**Solution:**
1. Check Render logs: Dashboard → Your Service → Logs
2. Look for error messages about missing env vars or database issues
3. Verify all environment variables are set correctly
4. Check FRONTEND_URL matches your frontend domain

#### Issue: CORS Error from Frontend

**Cause:** Frontend URL not configured in CORS settings

**Solution:**
1. Set FRONTEND_URL environment variable to your frontend domain
2. Redeploy the backend
3. Make sure there are no trailing slashes in the URL

### 6. Database Setup

Make sure your Supabase database has the required schema. Run the SQL migrations in this order:

1. `backend/database/schema.sql` - Creates all tables and types
2. `backend/database/migration_add_ideas_support.sql` - Adds ideas support

You can run these in Supabase → SQL Editor.

### 7. Update Frontend Configuration

After backend is deployed, update your frontend:

1. Create `.env.local` in `frontend/` directory:
   ```env
   NEXT_PUBLIC_API_URL=https://gimme-idea.onrender.com/api
   ```

2. For Vercel deployment, add this as an environment variable in project settings

## Backend API Endpoints

Once deployed, your API will be available at:

- **Health Check:** `GET https://gimme-idea.onrender.com/api`
- **Auth Login:** `POST https://gimme-idea.onrender.com/api/auth/login`
- **Get User:** `GET https://gimme-idea.onrender.com/api/auth/me`
- **Projects:** `GET/POST https://gimme-idea.onrender.com/api/projects`
- **Comments:** `GET/POST https://gimme-idea.onrender.com/api/comments`

## Support

If you encounter issues:

1. Check Render logs for detailed error messages
2. Verify all environment variables are set correctly
3. Test Supabase connection directly in Supabase dashboard
4. Ensure database schema is up to date

## Next Steps

After backend is successfully deployed:

1. Deploy frontend to Vercel
2. Set `NEXT_PUBLIC_API_URL` in Vercel environment variables
3. Update backend `FRONTEND_URL` with Vercel deployment URL
4. Test wallet connection and login flow end-to-end
